#%Module1.0
if {[string equal "VERSION" "3.6.2"]} {
  # No MPI support in older version
  set netcdfHome /opt/netcdf/VERSION/ROLLCOMPILER
  set ncoHome [lindex [glob /opt/nco/ROLLCOMPILER/*] 0]
} else {
  module-whatis "netcdf/nco"
  module-whatis "Version: VERSION"
  module-whatis "Description: netcdf"
  module-whatis "Compiler: COMPILERNAME"
  module-whatis "MPI Flavors: ROLLMPI"
  # Look for MPI flavor in LOADEDMODULES. If no MPI module is loaded, default to
  # first element in ROLLMPI.
  set mpi [lindex [split "ROLLMPI" "/ "] 0]
  foreach {module} [split $::env(LOADEDMODULES) :] {
    set module [lindex [split $module /] 0]
    if {[regexp [format {%s(/|\s|$)} $module] "ROLLMPI"]} {
      set mpi $module
    }
  }
  set netcdfHome /opt/netcdf/VERSION/ROLLCOMPILER/$mpi
  set ncoHome /opt/nco/ROLLCOMPILER/$mpi
}
setenv NETCDFHOME $netcdfHome
prepend-path PATH $netcdfHome/bin
prepend-path LD_LIBRARY_PATH $netcdfHome/lib
prepend-path LIBPATH $netcdfHome/lib
setenv NCOHOME $ncoHome
prepend-path PATH $ncoHome/bin
prepend-path LD_LIBRARY_PATH $ncoHome/lib
prepend-path LIBPATH $ncoHome/lib
if {! [string equal "VERSION" "3.6.2"]} {
  module load hdf5
}
