#%Module1.0
if {[string equal "VERSION" "3.6.2"]} {
  # No MPI support in older version
  set netcdfHome /opt/netcdf/VERSION/ROLLCOMPILER
  set ncoHome [lindex [glob /opt/nco/ROLLCOMPILER/*/*] 0]
} else {
  if {! [info exists ::env(MPIHOME)]} {
    puts stderr "Need to load an mpi module before loading netcdf"
    exit 1
  }
  foreach {x} [glob -directory /opt/netcdf/VERSION/ROLLCOMPILER -tails *] {
    if {[regexp $x $::env(MPIHOME)]} {
      set mpi $x
      break
    }
  }
  if {! [info exists mpi]} {
    if {[ regexp ScaleMP $::env(MPIHOME)]} {
        set mpi vsmp
    }
  }
  if {! [info exists mpi]} {
    puts stderr "No supported MPI flavor found"
    exit 1
  }
  foreach {x} [glob -directory /opt/netcdf/VERSION/ROLLCOMPILER/$mpi -tails *] {
    if {[regexp $x $::env(MPIHOME)]} {
      set network $x
      break
    }
  }
  if {! [info exists network]} {
    if {[ regexp ScaleMP $::env(MPIHOME)]} {
        set network ib
    }
  }
  if {! [info exists network]} {
    puts stderr "No supported network found"
    exit 1
  }
  set netcdfHome /opt/netcdf/VERSION/ROLLCOMPILER/$mpi/$network
  set ncoHome /opt/nco/ROLLCOMPILER/$mpi/$network
}
module-whatis "netcdf"
module-whatis "Version: VERSION" 
module-whatis "Description: netcdf"
module-whatis "Compiler: ROLLCOMPILER" 
setenv NETCDFHOME $netcdfHome
prepend-path PATH $netcdfHome/bin
prepend-path LD_LIBRARY_PATH $netcdfHome/lib
prepend-path LIBPATH $netcdfHome/lib
setenv NCOHOME $ncoHome
prepend-path PATH $ncoHome/bin
prepend-path LD_LIBRARY_PATH $ncoHome/lib
prepend-path LIBPATH $ncoHome/lib
